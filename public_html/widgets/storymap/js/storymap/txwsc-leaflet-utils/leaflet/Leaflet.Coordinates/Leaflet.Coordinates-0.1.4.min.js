L.Control.Coordinates=L.Control.extend({options:{position:"bottomright",decimals:4,decimalSeperator:".",labelTemplateLat:"Lat: {y}",labelTemplateLng:"Lng: {x}",labelFormatterLat:void 0,labelFormatterLng:void 0,enableUserInput:!0,useDMS:!1,useLatLngOrder:!1,centerUserCoordinates:!1},onAdd:function(t){this._map=t;var e="leaflet-control-coordinates",i=this._container=L.DomUtil.create("div",e),o=this.options;this._labelcontainer=L.DomUtil.create("div","uiElement label",i),this._label=L.DomUtil.create("span","labelFirst",this._labelcontainer),this._inputcontainer=L.DomUtil.create("div","uiElement input uiHidden",i);var n,r;return o.useLatLngOrder?(r=L.DomUtil.create("span","",this._inputcontainer),this._inputY=this._createInput("inputY",this._inputcontainer),n=L.DomUtil.create("span","",this._inputcontainer),this._inputX=this._createInput("inputX",this._inputcontainer)):(n=L.DomUtil.create("span","",this._inputcontainer),this._inputX=this._createInput("inputX",this._inputcontainer),r=L.DomUtil.create("span","",this._inputcontainer),this._inputY=this._createInput("inputY",this._inputcontainer)),n.innerHTML=o.labelTemplateLng.replace("{x}",""),r.innerHTML=o.labelTemplateLat.replace("{y}",""),L.DomEvent.on(this._inputX,"keyup",this._handleKeypress,this),L.DomEvent.on(this._inputY,"keyup",this._handleKeypress,this),t.on("mousemove",this._update,this),t.on("dragstart",this.collapse,this),t.whenReady(this._update,this),this._showsCoordinates=!0,o.enableUserInput&&L.DomEvent.addListener(this._container,"click",this._switchUI,this),i},_createInput:function(t,e){var i=L.DomUtil.create("input",t,e);return i.type="text",L.DomEvent.disableClickPropagation(i),i},_clearMarker:function(){this._map.removeLayer(this._marker)},_handleKeypress:function(t){switch(t.keyCode){case 27:this.collapse();break;case 13:this._handleSubmit(),this.collapse();break;default:this._handleSubmit()}},_handleSubmit:function(){var t=L.NumberFormatter.createValidNumber(this._inputX.value,this.options.decimalSeperator),e=L.NumberFormatter.createValidNumber(this._inputY.value,this.options.decimalSeperator);if(void 0!==t&&void 0!==e){var i=this._marker;i||(i=this._marker=L.marker(o,{icon:L.AwesomeMarkers.icon({prefix:"fa",markerColor:"orange",icon:"crosshairs",iconColor:"white",spin:!1})}),i.on("click",this._clearMarker,this));var o=new L.LatLng(e,t);i.setLatLng(o),i.addTo(this._map),this.options.centerUserCoordinates&&this._map.setView(o,this._map.getZoom())}},expand:function(){this._showsCoordinates=!1,this._map.off("mousemove",this._update,this),L.DomEvent.addListener(this._container,"mousemove",L.DomEvent.stop),L.DomEvent.removeListener(this._container,"click",this._switchUI,this),L.DomUtil.addClass(this._labelcontainer,"uiHidden"),L.DomUtil.removeClass(this._inputcontainer,"uiHidden")},_createCoordinateLabel:function(t){var e,i,o=this.options;return e=o.labelFormatterLng?o.labelFormatterLng(t.lng):L.Util.template(o.labelTemplateLng,{x:this._getNumber(t.lng,o)}),i=o.labelFormatterLat?o.labelFormatterLat(t.lat):L.Util.template(o.labelTemplateLat,{y:this._getNumber(t.lat,o)}),o.useLatLngOrder?i+" "+e:e+" "+i},_getNumber:function(t,e){var i;return i=e.useDMS?L.NumberFormatter.toDMS(t):L.NumberFormatter.round(t,e.decimals,e.decimalSeperator)},collapse:function(){if(!this._showsCoordinates){this._map.on("mousemove",this._update,this),this._showsCoordinates=!0;{this.options}if(L.DomEvent.addListener(this._container,"click",this._switchUI,this),L.DomEvent.removeListener(this._container,"mousemove",L.DomEvent.stop),L.DomUtil.addClass(this._inputcontainer,"uiHidden"),L.DomUtil.removeClass(this._labelcontainer,"uiHidden"),this._marker){var t=this._marker.getLatLng(),e=L.marker(t,{icon:L.AwesomeMarkers.icon({prefix:"fa",markerColor:"orange",icon:"crosshairs",iconColor:"white",spin:!1})}),i=L.DomUtil.create("div",""),o=L.DomUtil.create("div","",i);o.innerHTML=this._createCoordinateLabel(t);var n=L.DomUtil.create("a","",i);n.innerHTML="Remove",n.href="#";var r=L.DomEvent.stopPropagation;L.DomEvent.on(n,"click",r).on(n,"mousedown",r).on(n,"dblclick",r).on(n,"click",L.DomEvent.preventDefault).on(n,"click",function(){this._map.removeLayer(e)},this),e.bindPopup(i),e.addTo(this._map),this._map.removeLayer(this._marker),this._marker=null}}},_switchUI:function(t){L.DomEvent.stop(t),L.DomEvent.stopPropagation(t),L.DomEvent.preventDefault(t),this._showsCoordinates?this.expand():this.collapse()},onRemove:function(t){t.off("mousemove",this._update,this)},_update:function(t){var e=t.latlng,i=this.options;e&&(e=e.wrap(),this._currentPos=e,this._inputY.value=L.NumberFormatter.round(e.lat,i.decimals,i.decimalSeperator),this._inputX.value=L.NumberFormatter.round(e.lng,i.decimals,i.decimalSeperator),this._label.innerHTML=this._createCoordinateLabel(e))}}),L.control.coordinates=function(t){return new L.Control.Coordinates(t)},L.Map.mergeOptions({coordinateControl:!1}),L.Map.addInitHook(function(){this.options.coordinateControl&&(this.coordinateControl=new L.Control.Coordinates,this.addControl(this.coordinateControl))}),L.NumberFormatter={round:function(t,e,i){var o=L.Util.formatNum(t,e)+"",n=o.split(".");if(n[1]){for(var r=e-n[1].length;r>0;r--)n[1]+="0";o=n.join(i||".")}return o},toDMS:function(t){var e=Math.floor(t),i=60*(t-e),o=Math.floor(i),n=60*(i-o),r=Math.round(n);return 60==r&&(o++,r="00"),60==o&&(e++,o="00"),10>r&&(r="0"+r),10>o&&(o="0"+o),""+e+"&deg; "+o+"' "+r+"''"},createValidNumber:function(t,e){if(t&&t.length>0){var i=t.split(e||".");try{var o=Number(i.join("."));return isNaN(o)?void 0:o}catch(n){return void 0}}return void 0}};
