<!DOCTYPE html>
<!--
Demo map with all basemaps available from the txwsc-leaflet-utils library.

U.S. Geological Survey
Texas Water Science Center, Austin
jvrabel@usgs.gov
-->
<html>
    <!-- HTML HEAD -->
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>txwsc-leaflet-utils: Supported Basemaps</title>
        
        <!-- page styling -->
        <style type="text/css">
            * {
                margin: 0px;
                padding: 0px;
            }
            html, body, #map {
                height: 100%;
                width: 100%;
                margin: 0px;
                padding: 0px;
                overflow: hidden;
                background: white;
            }
            #controls_container {
                display: none;
                position: absolute;
                top: 10px;
                right: 10px;
                background-color: rgba(240,240,240,0.7);
                border: 1px solid #CCC;
                border-radius: 10px;
                padding: 10px;
                cursor: default;
                z-index: 999;
            }
            #checkbox_container {
                height: 200px;
                margin: 5px;
                overflow-y: scroll;
            }
            .basemap-thumb {
                border: 1px solid black;
                margin-right: 5px;
            }
            button,select,label,input {
                cursor: pointer;
            }
            button {
                width: 100px;
                padding: 2px;
            }
        </style>
        
        <!-- txwsc-leaflet-utils -->
        <script src="./utils/txwsc-leaflet-utils.min.js"></script>
        <script>
            U.ready = function() {
                // create map
                U.mapOpts.minZoom = 0;
                U.mapOpts.maxZoom = 19;
                U.map = new L.Map( "map", U.mapOpts );
                
                // update current zoom when map zooms
                U.map.on("zoomend", function() {
                    $("#currZoom").html( U.map.getZoom() );
                });
                U.map.setZoom(4);
                $("#currZoom").html( U.map.getZoom() );
                
                // add scale bar and zoomHome
                U.addScale(   {"position":"bottomleft"});
                U.addZoomHome({"position":"topleft"   });
                
                // popuplate menu & checkbox table with available options
                for (var basename in U._private.baseUrls) {
                    $("#basemap_menu").append( "<option id='" + basename + "_option'>" + basename + "</option>" );
                    $("#checkbox_table").append(
                        "<tr>" +
                            "<td><input type='checkbox' id='" + basename + "_checkbox' onclick='updateControls();' checked=true /><label for='" + basename + "_checkbox'>&nbsp;&nbsp;" + basename + "</label></td>" +
                        "</tr>"
                    );
                }
                
                // init basemap
                $("#basemap_menu").prop("selectedIndex",1);
                changeBasemap();
                
                // show controls
                $("#controls_container").fadeIn(400);
            };
            
            // function to change basemap
            var changeBasemap = function() {
                // change basemap
                var basemap = $.trim( $("#basemap_menu option:selected").text() );
                U.changeBaseMap({
                    "name"    : basemap,
                    "opacity" : 1
                });
                
                // update thumb
                $(".basemap-thumb").attr("src","./utils/img/thumb_basemap_" + basemap.toLowerCase() + ".png");
                
                // update mapserver link
                var url = ( $.trim( $("#basemap_menu option:selected").text() ).toLowerCase() === "none" ? [""] : U._private.getBaseUrls(basemap) );
                url = url[0]; // use 1st (can have many for overlays)
                url = url.match(/http:\/\/.+\/MapServer\//); // get root
                if (url) {
                    // AGS mapserver
                    $("#gotoMapservice").html(
                        "<a href='" + url + "' target='_blank' title='Open basemap mapserver page in a new browser window'>Go to Host MapServer</a>"
                    );
                } else {
                    // not AGS mapserver
                    $("#gotoMapservice").html("");
                }
            };
            
            // function to update controls
            var updateControls = function() {
                // show-hide menu item for checkboxes
                $("#checkbox_table").find("input:checkbox").each( function() {
                    var option_id = $(this).prop("id").replace(/_checkbox$/,"_option");
                    if ( $(this).prop("checked") ) {
                        $("#"+option_id).show(); // show in menu
                    } else {
                        $("#"+option_id).hide(); // hide in menu
                    }
                });
                // set menu if current selection is unchecked
                var selected_option_id   = $("#basemap_menu option:selected").prop("id");
                var selected_checkbox_id = selected_option_id.replace(/_option$/,"_checkbox");
                if ( ! $("#"+selected_checkbox_id ).prop("checked")  ) {
                    // current menu item not checked
                    if ( $("#checkbox_table").find("input:checkbox:checked").length > 0 ) {
                        // have checked items
                        var new_checkbox_id = $( $("#checkbox_table").find("input:checkbox:checked")[0] ).prop("id"); // id of 1st checked
                        var new_option_id   = new_checkbox_id.replace(/_checkbox$/,"_option"); // corresponding menu option id
                        $("#"+new_option_id).prop("selected",true); // select menu options
                    } else {
                        // nothing checked - use none
                        $("#basemap_menu").prop("selectedIndex",0);
                    }
                    changeBasemap();
                }
            };
        </script>
        
    </head>
    
    <!-- HTML BODY -->
    <body>
        <!-- map -->
        <div id="map">
            <div id="controls_container">
                <b>Choose a Supported Basemap:</b><br/>
                <select
                    id       = "basemap_menu"
                    onchange = "changeBasemap();"
                >
                    <option>None</option>
                </select>
                <table>
                    <tr>
                        <td ><img class="basemap-thumb" src="./utils/img/thumb_basemap_none.png" alt="Basemap thumbnail" title="Basemap thumbnail"/></td>
                        <td>Current Zoom Level: <b><span id="currZoom"></span><br/><span id="gotoMapservice"></span></b></td>
                    </tr>
                </table>
                <b>Uncheck to Remove from Menu:</b><br/>
                <div id="checkbox_container">
                    <table id="checkbox_table"></table>
                </div>
                <button type="button" onclick="$('#checkbox_table').find('input:checkbox').prop('checked',true ); updateControls();">Check All</button>
                <button type="button" onclick="$('#checkbox_table').find('input:checkbox').prop('checked',false); updateControls();">Uncheck All</button>
            </div>
        </div>
        
        <!-- basemap menu -->
        
    </body>
    
</html>
<!-- END -->